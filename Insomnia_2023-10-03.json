{"_type":"export","__export_format":4,"__export_date":"2023-10-03T11:38:43.507Z","__export_source":"insomnia.desktop.app:v2022.7.2","resources":[{"_id":"req_3ba9ab2d10b14a408c4d3b6d41508010","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332770694,"created":1696332719745,"url":"http://localhost:9080/v2/hello/CGI","name":"Version 2","description":"","method":"GET","body":{},"parameters":[],"headers":[{"id":"pair_ab83baad9ce74c799e47904c9946eda7","name":"apikey","value":"mykey","description":""}],"authentication":{},"metaSortKey":-1696332719745,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"wrk_0e1da2672b0b46c5845398b118b50dd4","parentId":null,"modified":1696327711258,"created":1696327711258,"name":"APISIX","description":"","scope":"collection","_type":"workspace"},{"_id":"req_fa13db39e25d4adba2803ab9fb9dfd03","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332041099,"created":1696331857972,"url":"http://localhost:9080/v1/hello","name":"test rate limit","description":"","method":"GET","body":{},"parameters":[],"headers":[{"id":"pair_f8b54eab1327467fa1667a4493a3680f","name":"apikey","value":"mykey","description":""}],"authentication":{},"metaSortKey":-1696331857972,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_e548c0c798564568b10ee2940377f706","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696331420515,"created":1696331364340,"url":"http://localhost:9080/hello","name":"Check Redirect","description":"","method":"GET","body":{},"parameters":[],"headers":[],"authentication":{},"metaSortKey":-1696331364340,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_3b1cc63d7561414b9c0a9050621a17fc","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696329146765,"created":1696327715841,"url":"http://localhost:9180/apisix/admin/routes/1","name":"1 create direct route ","description":"","method":"PUT","body":{"mimeType":"application/json","text":"{\n  \"name\": \"Direct Route to Old API\",\n  \"methods\": [\"GET\"],\n  \"uris\": [\"/hello\", \"/hello/\", \"/hello/*\"],\n  \"upstream\": {\n    \"nodes\": {\n      \"oldapi:8081\": 1\n    }\n  },\n  \"plugins\": {\n    \"prometheus\": {}\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1696327715841,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_2b63c9c745e94d5f92e783012de743aa","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696329181133,"created":1696329136356,"url":"http://localhost:9180/apisix/admin/upstreams/1","name":"2 create upstream","description":"","method":"PUT","body":{"mimeType":"application/json","text":"{\n  \"name\": \"Old API\",\n  \"nodes\": {\n    \"oldapi:8081\": 1\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1683850556272.5,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_8df645ca77fb476fa7dd64b5a086c868","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332666642,"created":1696329229814,"url":"http://localhost:9180/apisix/admin/global_rules/1","name":"3 plugin configuration ","description":"","method":"PUT","body":{"mimeType":"application/json","text":"{\n  \"name\": \"Monitor all routes\",\n  \"plugins\": {\n    \"prometheus\": {}\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1677611976488.25,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_4d015b28cb1340a1bb1ad4a614daaa07","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332664219,"created":1696329677541,"url":"http://localhost:9180/apisix/admin/plugin_configs/1","name":"4.1 regex for uri","description":"","method":"PUT","body":{"mimeType":"application/json","text":"{\n  \"plugins\": {\n    \"proxy-rewrite\": {\n      \"regex_uri\": [\"/v1/(.*)\", \"/$1\"]\n    }\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1674492686596.125,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_7fc8b69ce31746c9a8080089cb3e8f34","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332662157,"created":1696329711207,"url":"http://localhost:9180/apisix/admin/routes/2","name":"4.2 versioned route ","description":"","method":"PUT","body":{"mimeType":"application/json","text":"{\n  \"name\": \"Versioned Route to Old API\",\n  \"methods\": [\"GET\"],\n  \"uris\": [\"/v1/hello\", \"/v1/hello/\", \"/v1/hello/*\"],\n  \"upstream_id\": 1,\n  \"plugin_config_id\": 1\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1672933041650.0625,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_9178dd1b7e5345909e3e084536927325","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332660266,"created":1696330697491,"url":"http://localhost:9180/apisix/admin/routes/1","name":"5 redirect","description":"","method":"PATCH","body":{"mimeType":"application/json","text":"{\n  \"plugins\": {\n    \"redirect\": {\n      \"uri\": \"/v1$uri\",\n      \"ret_code\": 301\n    }\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1672153219177.0312,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_37ba236b97ba47938540ad79b2f624f9","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332658109,"created":1696331616863,"url":"http://localhost:9180/apisix/admin/plugin_configs/1","name":"6 rate limiting","description":"","method":"PATCH","body":{"mimeType":"application/json","text":"{\n  \"plugins\": {\n    \"unauth-limit\": {\n      \"count\": 1,\n      \"time_window\": 60,\n      \"key_type\": \"var\",\n      \"key\": \"consumer_name\",\n      \"rejected_code\": 429,\n      \"rejected_msg\": \"Please register at https://apisix.org/register to get your API token and enjoy unlimited calls\"\n    }\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1671763307940.5156,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_ff35438f284341738d2d4c69ccc1aa77","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332655972,"created":1696331701243,"url":"http://localhost:9180/apisix/admin/consumers","name":"7 consumer","description":"","method":"PUT","body":{"mimeType":"application/json","text":"{\n  \"username\": \"johndoe\",\n  \"plugins\": {\n    \"key-auth\": {\n      \"key\": \"mykey\"\n    }\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1671568352322.2578,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_bdfbf67233264275a3fd2e88a87c9c9d","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332653188,"created":1696332082792,"url":"http://localhost:9180/apisix/admin/plugin_configs/1","name":"8 mirror traffic","description":"","method":"PATCH","body":{"mimeType":"application/json","text":"{\n \"plugins\": {\n    \"proxy-rewrite\": {\n      \"_meta\": {\n        \"priority\": 1020\n      }\n    },\n    \"proxy-mirror\": {\n      \"host\": \"http://new.api:8082\"\n    }\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1671470874513.129,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_b8d646ac94904873a6363b9a175952eb","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332650957,"created":1696332425272,"url":"http://localhost:9180/apisix/admin/upstreams/2","name":"9.1 new api upstream","description":"","method":"PUT","body":{"mimeType":"application/json","text":"{\n  \"name\": \"New API\",\n  \"type\": \"roundrobin\",\n  \"nodes\": {\n    \"newapi:8082\": 1\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1671470874463.129,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_e806d6f4a89c43e69d45cdb736516adc","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332648932,"created":1696332489873,"url":"http://localhost:9180/apisix/admin/plugin_configs/1","name":"9.2 canary release","description":"After this you can test it with 'test rate limit'. You should see a change in the response ","method":"PATCH","body":{"mimeType":"application/json","text":"{\n \"plugins\": {\n    \"proxy-mirror\": null,\n    \"traffic-split\": {\n      \"rules\": [\n        {\n          \"weighted_upstreams\": [\n            {\n              \"upstream_id\": 2,\n              \"weight\": 1\n            },\n            {\n              \"weight\": 1\n            }\n          ]\n        }\n      ]\n    }\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1671422135583.5645,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_e0a017f447a649d9822ec5431cae38c2","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332676998,"created":1696332629138,"url":"http://localhost:9180/apisix/admin/routes/3","name":"10 v2 route","description":"","method":"PUT","body":{"mimeType":"application/json","text":"{\n  \"name\": \"Versioned Route to New API\",\n  \"methods\": [\"GET\"],\n  \"uris\": [\"/v2/hello\", \"/v2/hello/\", \"/v2/hello/*\"],\n  \"upstream_id\": 2,\n  \"plugins\": {\n    \"proxy-rewrite\": {\n      \"regex_uri\": [\"/v2/(.*)\", \"/$1\"]\n    },\n    \"unauth-limit\": {\n      \"count\": 1,\n      \"time_window\": 60,\n      \"key_type\": \"var\",\n      \"key\": \"consumer_name\",\n      \"rejected_code\": 429,\n      \"rejected_msg\": \"Please register at https://apisix.org/register to get your API token and enjoy unlimited calls\"\n    }\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1671422135533.5645,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"req_9d443f8bce884e18a6ec746dd3b9cbba","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696332959793,"created":1696332790181,"url":"http://localhost:9180/apisix/admin/plugin_configs/1","name":"11 deprecate v1","description":"With'test rate limit' you should now see, that the response header contains the deprecation flag.","method":"PATCH","body":{"mimeType":"application/json","text":"{\n \"plugins\": {\n    \"traffic-split\": null,\n    \"response-rewrite\": {\n      \"headers\": {\n        \"Deprecation\": \"true\",\n        \"Link\": \"<$scheme://$host:$server_port/v2/hello; rel=\\\"successor-version\\\"\"\n      }\n    }\n  }\n}"},"parameters":[],"headers":[{"id":"pair_cb61e7273bb64459a9f37a50eb840857","name":"X-API-KEY","value":"edd1c9f034335f136f87ad84b625c8f1","description":""},{"name":"Content-Type","value":"application/json"}],"authentication":{},"metaSortKey":-1671422135483.5645,"isPrivate":false,"settingStoreCookies":true,"settingSendCookies":true,"settingDisableRenderRequestBody":false,"settingEncodeUrl":true,"settingRebuildPath":true,"settingFollowRedirects":"global","_type":"request"},{"_id":"env_3aaa047906a9d544c3df7f657c7fc2bfc7da0ee6","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696327711261,"created":1696327711261,"name":"Base Environment","data":{},"dataPropertyOrder":null,"color":null,"isPrivate":false,"metaSortKey":1696327711262,"_type":"environment"},{"_id":"jar_3aaa047906a9d544c3df7f657c7fc2bfc7da0ee6","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696327711263,"created":1696327711263,"name":"Default Jar","cookies":[],"_type":"cookie_jar"},{"_id":"spc_4e762a7f591044bb8cc35a2d0143d9d8","parentId":"wrk_0e1da2672b0b46c5845398b118b50dd4","modified":1696327711258,"created":1696327711258,"fileName":"APISIX","contents":"","contentType":"yaml","_type":"api_spec"}]}